#! /usr/bin/env bash

git branch --contains | grep master
if [[ $? == 0 ]]; then
    set -e

    rst2html5 README.rst | \
      curl -H "Content-Type: text/html" \
           -H "Authorization: Bearer $(cat ~/.readme-token)" \
           -XPUT \
           --data-binary @- \
           "https://git.sr.ht/api/repos/${REPO_NAME}/readme"

    echo "README deployed successfully"
else
    echo "Skipping README deploy since not on master"
fi
