#! /usr/bin/env bash

set -x
git branch --contains | grep master
if [[ $? == 0 ]]; then
    set -e

    ./secrets_file_manager.sh extract
    rsync -vr --delete-after secrets/ root@bespin.sumnerevans.com:/etc/nixos/secrets
    rm -rf $SECRETS_FILE_PATH secrets

    echo "Secrets deployed successfully"
else
    echo "Secrets not deployed since not on master"
fi
